import React, { useState, useMemo } from 'react';
import { 
  ChevronRight, 
  Info, 
  CheckCircle2, 
  AlertTriangle, 
  Lightbulb, 
  BookOpen, 
  ShieldCheck,
  Zap,
  LayoutDashboard,
  HelpCircle
} from 'lucide-react';

// --- Daten & Logik ---

const RECOMMENDATIONS = {
  ai_integrated: {
    title: "KI-integriertes Prüfungsdesign",
    description: "In diesem Szenario ist die KI ein Werkzeug, das den Lernprozess unterstützt oder selbst Gegenstand der Reflexion ist.",
    tips: [
      "Fokus auf den Prozess: Bewerten Sie Entwürfe und Reflexionen über die KI-Nutzung.",
      "Kritisches Denken: Lassen Sie Schüler KI-Outputs auf Fehler und Biases prüfen.",
      "Personalisierung: Nutzen Sie KI für individuelles Feedback im Lernprozess (formativ).",
      "Transparenz: Klare Regeln, welche Prompts und Tools erlaubt sind."
    ],
    color: "bg-blue-50 border-blue-200 text-blue-800"
  },
  ai_restricted: {
    title: "KI-freies / KI-geschütztes Design",
    description: "Hier steht die Eigenleistung ohne technisches Outsourcing im Vordergrund, oft um Basiskompetenzen abzusichern.",
    tips: [
      "Präsenzformate: Schriftliche Ausarbeitung unter Aufsicht in der Schule.",
      "Mündliche Prüfungen: Fokus auf den direkten Dialog und Transferleistungen.",
      "Handschriftliche Dokumentation: Skizzen und Gedankenwege sichtbar machen.",
      "Methodenwechsel: Experimente oder praktische Vorführungen einbauen."
    ],
    color: "bg-amber-50 border-amber-200 text-amber-800"
  }
};

const QUESTIONS = [
  {
    id: 'format',
    text: 'Welche Art der Leistungsfeststellung planen Sie?',
    options: [
      { label: 'Formativ (Lernbegleitend, Feedback-orientiert)', value: 'formative', score: 2 },
      { label: 'Summativ (Abschlussorientiert, Note steht im Fokus)', value: 'summative', score: 0 }
    ]
  },
  {
    id: 'goal',
    text: 'Was ist das primäre Lernziel?',
    options: [
      { label: 'Kritisches Bewerten & Reflektieren von Inhalten', value: 'critical', score: 2 },
      { label: 'Nachweis von Basiswissen & Standardverfahren', value: 'basic', score: 0 },
      { label: 'Kreative Problemlösung & Transfer', value: 'creative', score: 1 }
    ]
  },
  {
    id: 'context',
    text: 'Wo findet die Bearbeitung hauptsächlich statt?',
    options: [
      { label: 'Häusliche Vorbereitung / Langzeitprojekt', value: 'home', score: 2 },
      { label: 'Kontrollierte Umgebung (Klassenzimmer/Aufsicht)', value: 'school', score: 0 }
    ]
  }
];

// --- Komponenten ---

const Card = ({ children, className = "" }) => (
  <div className={`bg-white rounded-xl shadow-sm border p-6 ${className}`}>
    {children}
  </div>
);

const App = () => {
  const [activeTab, setActiveTab] = useState('decision'); // 'decision' or 'guidelines'
  const [answers, setAnswers] = useState({});
  const [currentStep, setCurrentStep] = useState(0);

  const handleAnswer = (questionId, value) => {
    setAnswers(prev => ({ ...prev, [questionId]: value }));
    if (currentStep < QUESTIONS.length - 1) {
      setCurrentStep(prev => prev + 1);
    } else {
      setCurrentStep(QUESTIONS.length); // End reached
    }
  };

  const resetDecision = () => {
    setAnswers({});
    setCurrentStep(0);
  };

  const finalRecommendation = useMemo(() => {
    if (Object.keys(answers).length < QUESTIONS.length) return null;
    
    let totalScore = 0;
    QUESTIONS.forEach(q => {
      const selectedOption = q.options.find(o => o.value === answers[q.id]);
      totalScore += selectedOption?.score || 0;
    });

    return totalScore >= 3 ? RECOMMENDATIONS.ai_integrated : RECOMMENDATIONS.ai_restricted;
  }, [answers]);

  return (
    <div className="min-h-screen bg-slate-50 text-slate-900 font-sans p-4 md:p-8">
      {/* Header */}
      <header className="max-w-4xl mx-auto mb-8 text-center">
        <h1 className="text-3xl font-bold tracking-tight text-slate-800 mb-2">
          KI-Prüfungs-Navigator BW
        </h1>
        <p className="text-slate-600">
          Entscheidungshilfe für eine zeitgemäße Prüfungskultur gemäß Leitfaden Baden-Württemberg
        </p>
      </header>

      {/* Navigation */}
      <nav className="max-w-4xl mx-auto mb-8 flex justify-center gap-4">
        <button 
          onClick={() => setActiveTab('decision')}
          className={`flex items-center gap-2 px-6 py-2 rounded-full transition-all ${activeTab === 'decision' ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-slate-600 border'}`}
        >
          <HelpCircle size={18} /> Entscheidungshilfe
        </button>
        <button 
          onClick={() => setActiveTab('guidelines')}
          className={`flex items-center gap-2 px-6 py-2 rounded-full transition-all ${activeTab === 'guidelines' ? 'bg-indigo-600 text-white shadow-md' : 'bg-white text-slate-600 border'}`}
        >
          <LayoutDashboard size={18} /> Empfehlungen
        </button>
      </nav>

      <main className="max-w-4xl mx-auto">
        {activeTab === 'decision' ? (
          <div className="space-y-6">
            {currentStep < QUESTIONS.length ? (
              <Card className="animate-in fade-in slide-in-from-bottom-4 duration-500">
                <div className="mb-4 flex justify-between items-center">
                  <span className="text-xs font-semibold text-indigo-600 uppercase tracking-wider">Schritt {currentStep + 1} von {QUESTIONS.length}</span>
                  <div className="w-24 h-2 bg-slate-100 rounded-full overflow-hidden">
                    <div 
                      className="h-full bg-indigo-500 transition-all duration-300" 
                      style={{ width: `${((currentStep + 1) / QUESTIONS.length) * 100}%` }}
                    />
                  </div>
                </div>
                <h2 className="text-xl font-semibold mb-6">{QUESTIONS[currentStep].text}</h2>
                <div className="space-y-3">
                  {QUESTIONS[currentStep].options.map((opt) => (
                    <button
                      key={opt.value}
                      onClick={() => handleAnswer(QUESTIONS[currentStep].id, opt.value)}
                      className="w-full text-left p-4 rounded-lg border-2 border-slate-100 hover:border-indigo-400 hover:bg-indigo-50 transition-all flex justify-between items-center group"
                    >
                      <span className="font-medium">{opt.label}</span>
                      <ChevronRight className="text-slate-300 group-hover:text-indigo-500 transition-colors" size={20} />
                    </button>
                  ))}
                </div>
              </Card>
            ) : (
              <div className="animate-in zoom-in-95 duration-500">
                <Card className={`${finalRecommendation.color} border-2`}>
                  <div className="flex items-start gap-4 mb-4">
                    <div className="p-3 rounded-full bg-white/50 border border-current">
                      {finalRecommendation.title.includes('integriert') ? <Zap size={24} /> : <ShieldCheck size={24} />}
                    </div>
                    <div>
                      <h2 className="text-2xl font-bold">{finalRecommendation.title}</h2>
                      <p className="mt-1 opacity-90">{finalRecommendation.description}</p>
                    </div>
                  </div>
                  
                  <div className="bg-white/80 rounded-lg p-6 mt-6 shadow-sm">
                    <h3 className="font-bold mb-4 flex items-center gap-2 text-slate-800">
                      <Lightbulb size={20} className="text-amber-500" /> Gestaltungstipps für Sie:
                    </h3>
                    <ul className="space-y-3">
                      {finalRecommendation.tips.map((tip, i) => (
                        <li key={i} className="flex items-start gap-3 text-slate-700">
                          <CheckCircle2 size={18} className="text-green-500 shrink-0 mt-0.5" />
                          <span>{tip}</span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  <button 
                    onClick={resetDecision}
                    className="mt-8 text-sm font-medium underline underline-offset-4 opacity-70 hover:opacity-100 transition-opacity"
                  >
                    Analyse neu starten
                  </button>
                </Card>
              </div>
            )}
          </div>
        ) : (
          <div className="grid gap-6 md:grid-cols-2">
            <Card className="md:col-span-2 bg-indigo-900 text-indigo-50 border-none">
              <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                <BookOpen /> Der BW-Kontext
              </h2>
              <p className="opacity-90 leading-relaxed">
                In Baden-Württemberg rückt das „Prüfen im Zeitalter der KI“ die Kompetenzorientierung stärker in den Fokus. 
                Es geht nicht mehr nur um das <strong>Ergebnis</strong>, sondern verstärkt um den <strong>Weg dorthin</strong>. 
                Die Kultusverwaltung betont: KI soll dort integriert werden, wo sie den Lernprozess bereichert, 
                während bei Leistungsnachweisen die Eigenständigkeit gesichert bleiben muss.
              </p>
            </Card>

            <Card>
              <h3 className="text-lg font-bold mb-4 flex items-center gap-2 border-b pb-2">
                <Info className="text-blue-500" size={20} /> Wann ist KI sinnvoll?
              </h3>
              <ul className="space-y-3 text-sm text-slate-600">
                <li>• <strong>Brainstorming:</strong> Ideen generieren und strukturieren.</li>
                <li>• <strong>Feedback:</strong> Sofortige Rückmeldung bei Übungsphasen.</li>
                <li>• <strong>Differenzierung:</strong> Texte in verschiedene Niveaustufen übersetzen.</li>
                <li>• <strong>KI-Literacy:</strong> Das Tool selbst zum Unterrichtsthema machen.</li>
              </ul>
            </Card>

            <Card>
              <h3 className="text-lg font-bold mb-4 flex items-center gap-2 border-b pb-2">
                <AlertTriangle className="text-amber-500" size={20} /> Wann ist KI kritisch?
              </h3>
              <ul className="space-y-3 text-sm text-slate-600">
                <li>• <strong>Basissicherung:</strong> Abfrage von reinem Reproduktionswissen.</li>
                <li>• <strong>Hausarbeiten:</strong> Ohne Reflexionsbericht schwer verifizierbar.</li>
                <li>• <strong>Summative Tests:</strong> Wenn die KI die kognitive Leistung komplett übernimmt.</li>
                <li>• <strong>Datenschutz:</strong> Beachtung der DSGVO-konformen Tools.</li>
              </ul>
            </Card>
            
            <Card className="md:col-span-2 border-l-4 border-l-green-500">
              <h3 className="text-lg font-bold mb-2">Allgemeine Empfehlung</h3>
              <p className="text-slate-600">
                Nutzen Sie das <strong>„Zwei-Säulen-Modell“</strong>: 
                Säule 1 (Formativ) nutzt KI als Co-Pilot für maximales Wachstum. 
                Säule 2 (Summativ) nutzt kontrollierte Umgebungen oder reflexive Formate, um die echte Eigenleistung sicherzustellen. 
                Verschieben Sie den Fokus von <em>„Was weißt du?“</em> hin zu <em>„Wie hast du dieses Ergebnis mit deinen Werkzeugen erarbeitet?“</em>.
              </p>
            </Card>
          </div>
        )}
      </main>

      <footer className="max-w-4xl mx-auto mt-12 pt-8 border-t text-center text-slate-400 text-xs">
        Entwickelt für die moderne Schulentwicklung • © 2024 • Pädagogisches Framework BW
      </footer>
    </div>
  );
};

export default App;
